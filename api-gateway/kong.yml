_format_version: "3.0"
_transform: true

services:
  - name: auth-service
    url: http://auth-service:8080
    routes:
      - name: login
        paths: [/v1/auth/login]
        strip_path: false
        methods: [POST]

      - name: refresh-token
        paths: [/v1/auth/refresh-token]
        strip_path: false
        methods: [POST]

      - name: logout
        paths: [/v1/auth/logout]
        strip_path: false
        methods: [POST]
        plugins:
          - name: jwt
            config:
              key_claim_name: iss
              secret_is_base64: false
              claims_to_verify: [exp]

      - name: validate-token
        paths: [/v1/auth/validate]
        strip_path: false
        methods: [POST]

  - name: user-service
    url: http://auth-service:8080
    routes:
      - name: list-users
        paths: [/v1/users]
        strip_path: false
        methods: [GET]
        plugins:
          - name: jwt
            config:
              key_claim_name: iss
              secret_is_base64: false
              claims_to_verify: [exp]

      - name: create-user
        paths: [/v1/users]
        strip_path: false
        methods: [POST]
        plugins:
          - name: jwt
            config:
              key_claim_name: iss
              secret_is_base64: false
              claims_to_verify: [exp]

      - name: get-user
        paths:
          - "~/v1/users/([0-9]+)$"
        strip_path: false
        methods: [GET, OPTIONS]
        regex_priority: 200
        plugins:
          - name: jwt
            config:
              key_claim_name: iss
              secret_is_base64: false
              claims_to_verify: [exp]

      - name: update-user
        paths:
          - "~/v1/users/([0-9]+)$"
        strip_path: false
        methods: [PUT, OPTIONS]
        regex_priority: 200
        plugins:
          - name: jwt
            config:
              key_claim_name: iss
              secret_is_base64: false
              claims_to_verify: [exp]

      - name: delete-user
        paths:
          - "~/v1/users/([0-9]+)$"
        strip_path: false
        methods: [DELETE, OPTIONS]
        regex_priority: 200
        plugins:
          - name: jwt
            config:
              key_claim_name: iss
              secret_is_base64: false
              claims_to_verify: [exp]
plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
      methods: [GET, POST, PUT, DELETE, PATCH, OPTIONS]
      headers: [Accept, Authorization, Content-Type]
      exposed_headers: ["*"]
      max_age: 3600
      credentials: true

consumers:
  - username: internal-auth-client

jwt_secrets:
  - consumer: internal-auth-client
    key: "auth-service"
    secret: coderprovip&&**__provip01
    algorithm: HS256
